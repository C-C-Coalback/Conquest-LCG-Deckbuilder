{% extends "base.html" %}
{% block title %}Ajax with Django{% endblock %}
{% block content %}
{% load static %}
<link rel="stylesheet" href="{% static 'card_search_style.css' %}">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<body>
    <div class="filters-container">
        <h1>Card Search Placeholder</h1>
        <form id="myForm">
            Card Name: <input id="searchInput" type="text" name="search"><br>
            Faction: <select name="faction" id="faction">
                        <option value="None"></option>
                        <option value="Space Marines">Space Marines</option>
                        <option value="Tau">Tau</option>
                        <option value="Eldar">Eldar</option>
                        <option value="Dark Eldar">Dark Eldar</option>
                        <option value="Chaos">Chaos</option>
                        <option value="Orks">Orks</option>
                        <option value="Astra Militarum">Astra Militarum</option>
                        <option value="Neutral">Neutral</option>
                        <option value="Tyranids">Tyranids</option>
                        <option value="Necrons">Necrons</option>
                    </select><br>
            <button type="submit">Submit</button>
        </form>
        <div id="responseMessage"></div>
    </div>
    <script>
        // Ajax setup for form submission
        $(document).ready(function() {
            $('#myForm').on('submit', function(event) {
                event.preventDefault();

                $.ajax({
                    url: '/cards/ajax/',  // The URL of the Django view that handles the request
                    type: 'POST',
                    data: {
                        'search': $('#searchInput').val(),
                        'faction': $('#faction').val(),
                        'csrfmiddlewaretoken': '{{ csrf_token }}' // CSRF token for security
                    },
                    success: function(response) {
                        $('#responseMessage').text(response.message);  // Update the page dynamically
                        var card_names = response.cards;
                        const image_names = response.image_names;
                        e = document.getElementById("responseMessage");
                        e.innerHTML = ``;
                        var img_src = "";
                        var img_link = "";
                        var new_string = "";
                        for (let i = 0; i < image_names.length; i++) {
                            new_string = `<a href=`
                            img_link = "/cards/" + image_names[i] + "/"
                            new_string += img_link;
                            new_string += `>`;
                            // new_string = `<a href=/cards/`;
                            img_link = image_names[i];
                            // new_string += img_link + `/`;
                            img_src ="/static/images/CardImages/" + image_names[i] + ".jpg";
                            new_string += `<img src=` + img_src + ` alt="No image">`;
                            new_string += `</a>`
                            e.innerHTML += new_string;
                        }
                    }
                });
            });
        });
    </script>
{% endblock %}
