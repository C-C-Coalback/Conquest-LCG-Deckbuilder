{% extends "base.html" %}
{% block title %}{% if card_name %} {{ card_name }} {% else %} Card Data {% endif %} {% endblock %}
{% block content %}
{% load static %}
<link rel="stylesheet" href="{% static 'card_data.css' %}">
    <div id="main-container">
        <div id="card-container">
        <img  src="/static/images/CardImages/{{ image_name }}.jpg"{% if rotate %} class="rotated-card-image" style="rotate:270deg; margin-top:-110px; padding-right:150px;"{% else %} class="card-image"{% endif %}>
        {% if card_type == "Warlord" %}
            <br><button id="bloodied-toggle" onclick="changeBloodied();">View Bloodied Side</button>
        {% elif errata_text == "There is Errata" %}
            <br><button id="errata-toggle" onclick="changeErrata();">View Errata Version</button>
        {% endif %}
        </div>
        <div id="card-info">
            <h2>{{ card_name }}</h2>
            <h3>{{ cycle_text|linebreaks }}</h3>
            <h3>{{ faction }}</h3>
            <h3>{{ loyalty }} {{ card_type }}</h3>
            <h3>{{ traits }}</h3>
            <h3>{{ text|linebreaks }}</h3>
            {% if cost != "-1" %}
                <h3>Cost: {{ cost }}</h3>
            {% endif %}
            <p></p>
            {% if shields != "0" %}
                <h3>Shields: {{ shields }}</h3>
            {% endif %}
            {% if card_type == "Warlord" %}
                <h3>{{ attack }} attack, {{ health }} health</h3>
            {% elif is_unit == "True" %}
                <h3>{{ command }} command, {{ attack }} attack, {{ health }} health</h3>
            {% endif %}
            {% if card_type == "Warlord" %}
                <h3>When bloodied:</h3>
                <h3>{{ bloodied_text|linebreaks }}</h3>
                <h3>{{ bloodied_attack }} attack, {{ bloodied_health }} health</h3>
            {% endif %}
        </div>
        {% if errata_text == "There is Errata" %}
        <div id="errata-card-info">
            <h2>{{ errata_card_name }}</h2>
            <h3>{{ errata_cycle_text|linebreaks }}</h3>
            <h3>{{ errata_faction }}</h3>
            <h3>{{ errata_loyalty }} {{ errata_card_type }}</h3>
            <h3>{{ errata_traits }}</h3>
            <h3>{{ errata_full_text|linebreaks }}</h3>
            {% if errata_cost != "-1" %}
                <h3>Cost: {{ errata_cost }}</h3>
            {% endif %}
            <p></p>
            {% if errata_shields != "0" %}
                <h3>Shields: {{ errata_shields }}</h3>
            {% endif %}
            {% if errata_card_type == "Warlord" %}
                <h3>{{ errata_attack }} attack, {{ errata_health }} health</h3>
            {% elif errata_is_unit == "True" %}
                <h3>{{ errata_command }} command, {{ errata_attack }} attack, {{ errata_health }} health</h3>
            {% endif %}
            {% if errata_card_type == "Warlord" %}
                <h3>When bloodied:</h3>
                <h3>{{ errata_bloodied_text|linebreaks }}</h3>
                <h3>{{ errata_bloodied_attack }} attack, {{ errata_bloodied_health }} health</h3>
            {% endif %}
        </div>
        {% endif %}
        <div id="ban-info">
            <h2>Banlist/Errata</h2>
            <h3>{{ errata_text }}</h3>
            <h3>{{ ban_text }}</h3>
        </div>
    </div>
        {% if card_type == "Warlord" %}
            <div class="sig-squad-center">
                <h2>Signature Squad</h2>
            </div>
            <div class="sig-squad-center">
                <div id="sig-squad-grid">
                    {% for image_name, card_link in sig_squad %}
                        <a href="{{ card_link }}"><img src="{{ image_name }}" class="sig-squad-card"></a>
                    {% endfor %}
                </div>
            </div>
        {% endif %}
    <div class="rating-container first-rating-container">
        <h3>Average rating:</h3>
    </div>
    <div class="rating-container">
        {% for rating in ratings %}
            {% if rating %}
                <svg version="1.0" width="50" height="50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 64 64" enable-background="new 0 0 64 64" xml:space="preserve" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path fill="#ffd300" d="M63.893,24.277c-0.238-0.711-0.854-1.229-1.595-1.343l-19.674-3.006L33.809,1.15 C33.479,0.448,32.773,0,31.998,0s-1.48,0.448-1.811,1.15l-8.815,18.778L1.698,22.935c-0.741,0.113-1.356,0.632-1.595,1.343 c-0.238,0.71-0.059,1.494,0.465,2.031l14.294,14.657L11.484,61.67c-0.124,0.756,0.195,1.517,0.822,1.957 c0.344,0.243,0.747,0.366,1.151,0.366c0.332,0,0.666-0.084,0.968-0.25l17.572-9.719l17.572,9.719c0.302,0.166,0.636,0.25,0.968,0.25 c0.404,0,0.808-0.123,1.151-0.366c0.627-0.44,0.946-1.201,0.822-1.957l-3.378-20.704l14.294-14.657 C63.951,25.771,64.131,24.987,63.893,24.277z"></path> </g></svg>
            {% else %}
                <svg version="1.0" width="50" height="50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 64 64" enable-background="new 0 0 64 64" xml:space="preserve" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path fill="#231F20" d="M32.001,2.484c0.279,0,0.463,0.509,0.463,0.509l8.806,18.759l20.729,3.167L47,40.299L50.541,62 l-18.54-10.254L13.461,62l3.541-21.701L2.003,24.919l20.729-3.167L31.53,3.009C31.53,3.009,31.722,2.484,32.001,2.484 M32.001,0.007 c-0.775,0-1.48,0.448-1.811,1.15l-8.815,18.778L1.701,22.941c-0.741,0.113-1.356,0.632-1.595,1.343 c-0.238,0.71-0.059,1.494,0.465,2.031l14.294,14.657l-3.378,20.704c-0.124,0.756,0.195,1.517,0.822,1.957 C12.653,63.877,13.057,64,13.461,64c0.332,0,0.666-0.084,0.968-0.25l17.572-9.719l17.572,9.719c0.302,0.166,0.636,0.25,0.968,0.25 c0.404,0,0.808-0.123,1.151-0.366c0.627-0.44,0.946-1.201,0.822-1.957l-3.378-20.704l14.294-14.657 c0.523-0.537,0.703-1.321,0.465-2.031c-0.238-0.711-0.854-1.229-1.595-1.343l-19.674-3.006L33.812,1.157 C33.481,0.455,32.776,0.007,32.001,0.007L32.001,0.007z"></path> </g></svg>
            {% endif %}
        {% endfor %}
    </div>
    <div class="rating-container">
        <h3>from {{ num_ratings }} ratings.{% if user.is_authenticated %} Your rating: {% endif %}</h3>
    </div>
    {% if user.is_authenticated %}
    <div class="rating-container">
        {% for rating, value in own_ratings %}
            {% if rating %}
                <svg class="own-rating" version="1.0" onclick="changeRating(this);" data-value="{{ value }}" width="50" height="50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 64 64" enable-background="new 0 0 64 64" xml:space="preserve" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path fill="#ffd300" d="M63.893,24.277c-0.238-0.711-0.854-1.229-1.595-1.343l-19.674-3.006L33.809,1.15 C33.479,0.448,32.773,0,31.998,0s-1.48,0.448-1.811,1.15l-8.815,18.778L1.698,22.935c-0.741,0.113-1.356,0.632-1.595,1.343 c-0.238,0.71-0.059,1.494,0.465,2.031l14.294,14.657L11.484,61.67c-0.124,0.756,0.195,1.517,0.822,1.957 c0.344,0.243,0.747,0.366,1.151,0.366c0.332,0,0.666-0.084,0.968-0.25l17.572-9.719l17.572,9.719c0.302,0.166,0.636,0.25,0.968,0.25 c0.404,0,0.808-0.123,1.151-0.366c0.627-0.44,0.946-1.201,0.822-1.957l-3.378-20.704l14.294-14.657 C63.951,25.771,64.131,24.987,63.893,24.277z"></path> </g></svg>
            {% else %}
                <svg class="own-rating" version="1.0" onclick="changeRating(this);" data-value="{{ value }}" width="50" height="50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 64 64" enable-background="new 0 0 64 64" xml:space="preserve" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path fill="#231F20" d="M32.001,2.484c0.279,0,0.463,0.509,0.463,0.509l8.806,18.759l20.729,3.167L47,40.299L50.541,62 l-18.54-10.254L13.461,62l3.541-21.701L2.003,24.919l20.729-3.167L31.53,3.009C31.53,3.009,31.722,2.484,32.001,2.484 M32.001,0.007 c-0.775,0-1.48,0.448-1.811,1.15l-8.815,18.778L1.701,22.941c-0.741,0.113-1.356,0.632-1.595,1.343 c-0.238,0.71-0.059,1.494,0.465,2.031l14.294,14.657l-3.378,20.704c-0.124,0.756,0.195,1.517,0.822,1.957 C12.653,63.877,13.057,64,13.461,64c0.332,0,0.666-0.084,0.968-0.25l17.572-9.719l17.572,9.719c0.302,0.166,0.636,0.25,0.968,0.25 c0.404,0,0.808-0.123,1.151-0.366c0.627-0.44,0.946-1.201,0.822-1.957l-3.378-20.704l14.294-14.657 c0.523-0.537,0.703-1.321,0.465-2.031c-0.238-0.711-0.854-1.229-1.595-1.343l-19.674-3.006L33.812,1.157 C33.481,0.455,32.776,0.007,32.001,0.007L32.001,0.007z"></path> </g></svg>
            {% endif %}
        {% endfor %}
    </div>
    <div class="rating-container">
        {% if not has_rated %}
            <h3>You have not yet rated this card.</h3>
        {% endif %}
    </div>
    {% endif %}
    <div id="card-reviews">
        {% if noc is True %}
            <div>
                No comments yet.
            </div>
        {% endif %}
        {% for name, time, text, id in comments %}
        <div class="comment-class">
            <div class="comment-name">
                <img class="comment-avatar" src="/media/{{ name }}.jpg" onerror="this.onerror=null; this.src='/static/images/defaultprofile.jpg'">
                <p>{{ name }}<br>{{ time }}</p>
            </div>
            <h3 class="comment-content"> {{ text|linebreaks }}</h3>
            {% if user.username == name %}
                <form class="delete-comment" method="post">
                    {% csrf_token %}
                            <input name="username" value="{{ user.username }}" style="display:none;">
                            <input name="flag" value="DELETE" style="display:none;">
                            <input name="idcomment" value="{{ id }}" style="display:none;">
                    <button type="submit">Delete</button>
                </form>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    <form id="comment-form" method="post">
        {% csrf_token %}
        Write a comment using the text box below.<br>
        <input id="username" name="username" value="{{ user.username }}" style="display:none;">
        <input name="flag" value="POST" style="display:none;">
        <textarea id="commentInput" name="comment" rows="10" cols="80"></textarea><br>
        <button type="submit">Submit</button>
    </form>
<script>
    const image = document.getElementById("card-image");
    const bloodied_button = document.getElementById("bloodied-toggle");
    const errata_button = document.getElementById("errata-toggle");
    function changeBloodied() {
        if (image.src.includes("_bloodied")) {
            image.src = image.src.replace("_bloodied", "");
            bloodied_button.innerHTML = "View Bloodied Side";
        } else {
            image.src = image.src.replace(".jpg", "_bloodied.jpg");
            bloodied_button.innerHTML = "View Hale Side";
        }
    }

    function changeRating(e) {
        const value = e.dataset.value;
        const current_url = document.URL;
        const url_split = current_url.split("/");
        const card_name = url_split[url_split.length - 2];
        location.href = "/cards/ratings/" + card_name + "/" + value + "/";
    }

    function changeErrata() {
        if (image.src.includes("_apoka")) {
            image.src = image.src.replace("_apoka", "");
            errata_button.innerHTML = "View Original Version";
            var e = document.getElementById("card-info");
            e.style.display = "block";
            e = document.getElementById("errata-card-info");
            e.style.display = "none";
        } else {
            image.src = image.src.replace(".jpg", "_apoka.jpg");
            errata_button.innerHTML = "View Errata Version";
            var e = document.getElementById("card-info");
            e.style.display = "none";
            e = document.getElementById("errata-card-info");
            e.style.display = "block";
        }
    }
</script>
{% endblock %}
